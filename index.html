<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rose, Bud & Thorn Journal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyBDkSgOGXitR8_--NHu1movVU6QvlpgVzE",
            authDomain: "rose-bud-thorn-2d9ce.firebaseapp.com",
            projectId: "rose-bud-thorn-2d9ce",
            storageBucket: "rose-bud-thorn-2d9ce.firebasestorage.app",
            messagingSenderId: "583929113592",
            appId: "1:583929113592:web:4edb80d6f765ef69e7c40d"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();

        function JournalApp() {
            const [entries, setEntries] = useState([]);
            const [loading, setLoading] = useState(true);
            const [rose, setRose] = useState('');
            const [bud, setBud] = useState('');
            const [thorn, setThorn] = useState('');
            const [user, setUser] = useState(null);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isSignUp, setIsSignUp] = useState(false);
            const [authError, setAuthError] = useState('');
            const [submitting, setSubmitting] = useState(false);
            const [commentText, setCommentText] = useState({});
            const [showComments, setShowComments] = useState({});
            const [userReactions, setUserReactions] = useState({});
            const [currentDateTime, setCurrentDateTime] = useState(new Date());
            const [isPrivate, setIsPrivate] = useState(false);
            const [menuOpen, setMenuOpen] = useState(false);
            const [currentView, setCurrentView] = useState('community');
            const [userSettings, setUserSettings] = useState({ emailNotifications: true });
            const [showShareModal, setShowShareModal] = useState(false);
            const [shareEmail, setShareEmail] = useState('');

            useEffect(() => {
                sessionStorage.removeItem('journal_username');
                sessionStorage.removeItem('journal_location');

                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    if (user) {
                        loadEntries();
                        loadUserSettings(user.uid);
                    } else {
                        setLoading(false);
                    }
                });

                const timer = setInterval(() => {
                    setCurrentDateTime(new Date());
                }, 1000);

                return () => {
                    unsubscribe();
                    clearInterval(timer);
                };
            }, []);

            const loadUserSettings = async (userId) => {
                try {
                    const doc = await db.collection('userSettings').doc(userId).get();
                    if (doc.exists) {
                        setUserSettings(doc.data());
                    }
                } catch (error) {
                    console.error('Error loading user settings:', error);
                }
            };

            const toggleNotifications = async () => {
                const newSettings = { ...userSettings, emailNotifications: !userSettings.emailNotifications };
                setUserSettings(newSettings);
                
                try {
                    await db.collection('userSettings').doc(user.uid).set(newSettings);
                } catch (error) {
                    console.error('Error saving notification settings:', error);
                }
            };

            const loadEntries = () => {
                db.collection('entries')
                    .orderBy('date', 'desc')
                    .onSnapshot((snapshot) => {
                        const loadedEntries = [];
                        snapshot.forEach((doc) => {
                            loadedEntries.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(loadedEntries);
                        setLoading(false);
                    }, (error) => {
                        console.error('Error loading entries:', error);
                        setLoading(false);
                    });
            };

            const sendNotificationEmail = async (recipientEmail, notificationType, entryData) => {
                console.log(`üìß Email notification would be sent to: ${recipientEmail}`);
                console.log(`Type: ${notificationType}`);
                console.log(`Entry data:`, entryData);
                // In production: integrate with SendGrid, Mailgun, or Firebase Cloud Functions
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                setAuthError('');
                
                try {
                    if (isSignUp) {
                        await auth.createUserWithEmailAndPassword(email, password);
                    } else {
                        await auth.signInWithEmailAndPassword(email, password);
                    }
                    setEmail('');
                    setPassword('');
                } catch (error) {
                    console.error('Authentication error:', error);
                    let errorMessage = '';
                    
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'This email is already registered. Please sign in instead.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Password should be at least 6 characters.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Please enter a valid email address.';
                    } else if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email. Please sign up.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/invalid-credential') {
                        errorMessage = 'Invalid email or password. Please try again.';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMessage = 'Network error. Please check your internet connection and try again.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many failed attempts. Please wait a few minutes and try again.';
                    } else if (error.code === 'auth/operation-not-allowed') {
                        errorMessage = 'Email/password authentication is not enabled. Please contact support.';
                    } else {
                        errorMessage = `Error (${error.code || 'unknown'}): ${error.message || 'An unexpected error occurred. Please try again.'}`;
                    }
                    
                    setAuthError(errorMessage);
                }
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    setRose('');
                    setBud('');
                    setThorn('');
                    setCurrentView('community');
                } catch (error) {
                    console.error('Error signing out:', error);
                }
            };

            const handleSubmit = async () => {
                if (!rose.trim() || !bud.trim() || !thorn.trim() || !user) return;

                setSubmitting(true);
                const entry = {
                    rose: rose.trim(),
                    bud: bud.trim(),
                    thorn: thorn.trim(),
                    userEmail: user.email,
                    userId: user.uid,
                    date: firebase.firestore.Timestamp.now(),
                    reactions: { heart: 0, like: 0, celebrate: 0, compassion: 0 },
                    comments: [],
                    isPrivate: isPrivate
                };

                try {
                    await db.collection('entries').add(entry);
                    setRose('');
                    setBud('');
                    setThorn('');
                    setIsPrivate(false);
                } catch (error) {
                    console.error('Error saving entry:', error);
                    alert('Failed to save entry. Please try again.');
                } finally {
                    setSubmitting(false);
                }
            };

            const handleReaction = async (entryId, reactionType) => {
                const reactionKey = `${entryId}-${reactionType}`;
                const hasReacted = userReactions[reactionKey];

                try {
                    const entryRef = db.collection('entries').doc(entryId);
                    const entry = entries.find(e => e.id === entryId);
                    
                    if (hasReacted) {
                        await entryRef.update({
                            [`reactions.${reactionType}`]: (entry.reactions?.[reactionType] || 0) - 1
                        });
                        setUserReactions({ ...userReactions, [reactionKey]: false });
                    } else {
                        await entryRef.update({
                            [`reactions.${reactionType}`]: (entry.reactions?.[reactionType] || 0) + 1
                        });
                        setUserReactions({ ...userReactions, [reactionKey]: true });
                        
                        if (entry.userId !== user.uid) {
                            const ownerSettingsDoc = await db.collection('userSettings').doc(entry.userId).get();
                            const ownerSettings = ownerSettingsDoc.data();
                            
                            if (ownerSettings?.emailNotifications) {
                                await sendNotificationEmail(entry.userEmail, 'reaction',
                                    { reactionType, reactorEmail: user.email, entry });
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error updating reaction:', error);
                }
            };

            const handleComment = async (entryId) => {
                const text = commentText[entryId]?.trim();
                if (!text || !user) return;

                const newComment = {
                    id: Date.now().toString(),
                    userEmail: user.email,
                    userId: user.uid,
                    text: text,
                    date: firebase.firestore.Timestamp.now()
                };

                try {
                    const entryRef = db.collection('entries').doc(entryId);
                    const entry = entries.find(e => e.id === entryId);
                    
                    await entryRef.update({
                        comments: firebase.firestore.FieldValue.arrayUnion(newComment)
                    });
                    setCommentText({ ...commentText, [entryId]: '' });
                    
                    if (entry.userId !== user.uid) {
                        const ownerSettingsDoc = await db.collection('userSettings').doc(entry.userId).get();
                        const ownerSettings = ownerSettingsDoc.data();
                        
                        if (ownerSettings?.emailNotifications) {
                            await sendNotificationEmail(entry.userEmail, 'comment',
                                { commenterEmail: user.email, commentText: text, entry });
                        }
                    }
                } catch (error) {
                    console.error('Error adding comment:', error);
                }
            };

            const handleShareViaEmail = () => {
                const subject = encodeURIComponent('Check out Rose, Bud & Thorn Journal!');
                const body = encodeURIComponent(
                    `I've been using Rose, Bud & Thorn Journal to reflect on my daily experiences. Join me!\n\n${window.location.href}`
                );
                
                if (shareEmail.trim()) {
                    window.location.href = `mailto:${shareEmail}?subject=${subject}&body=${body}`;
                } else {
                    window.location.href = `mailto:?subject=${subject}&body=${body}`;
                }
                
                setShareEmail('');
                setShowShareModal(false);
            };

            const formatDate = (timestamp) => {
                if (!timestamp) return '';
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
            };

            const formatCurrentDateTime = () => {
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    second: '2-digit'
                };
                return currentDateTime.toLocaleDateString('en-US', options);
            };

            const getUserDisplay = (entry) => {
                if (entry.userEmail) return entry.userEmail;
                if (entry.username && entry.location) return `${entry.username} ‚Ä¢ ${entry.location}`;
                if (entry.username) return entry.username;
                return 'Anonymous User';
            };

            const getFilteredEntries = () => {
                if (currentView === 'myEntries') {
                    return entries.filter(entry => entry.userId === user.uid);
                } else {
                    return entries.filter(entry => !entry.isPrivate || entry.userId === user.uid);
                }
            };

            const isFormValid = rose.trim() && bud.trim() && thorn.trim();
            const isAuthValid = email.trim() && password.trim();

            if (!user) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-rose-50 via-amber-50 to-emerald-50 p-4 flex items-center justify-center">
                        <div className="max-w-md w-full">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">Rose, Bud & Thorn</h1>
                                <p className="text-gray-600">Share your daily reflections</p>
                            </div>

                            <div className="bg-white rounded-2xl shadow-xl p-8">
                                <h2 className="text-2xl font-semibold text-gray-800 mb-6">
                                    {isSignUp ? 'Create Account' : 'Sign In'}
                                </h2>
                                
                                <form onSubmit={handleAuth} className="space-y-6">
                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                            ‚úâÔ∏è Email
                                        </label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            placeholder="your.email@example.com"
                                            className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-gray-400 focus:outline-none"
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                            üîí Password
                                        </label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            placeholder={isSignUp ? "At least 6 characters" : "Enter your password"}
                                            className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-gray-400 focus:outline-none"
                                        />
                                    </div>

                                    {authError && (
                                        <div className="bg-red-50 border-2 border-red-200 rounded-lg p-3 text-sm text-red-700">
                                            {authError}
                                        </div>
                                    )}

                                    <button
                                        type="submit"
                                        disabled={!isAuthValid}
                                        className="w-full bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-700 transition disabled:opacity-50"
                                    >
                                        {isSignUp ? 'Sign Up' : 'Sign In'}
                                    </button>
                                </form>

                                <div className="mt-6 text-center">
                                    <button
                                        onClick={() => {
                                            setIsSignUp(!isSignUp);
                                            setAuthError('');
                                        }}
                                        className="text-gray-600 hover:text-gray-800 underline text-sm"
                                    >
                                        {isSignUp 
                                            ? 'Already have an account? Sign in' 
                                            : "Don't have an account? Sign up"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-rose-50 via-amber-50 to-emerald-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-start mb-4">
                            <div className="relative">
                                <button
                                    onClick={() => setMenuOpen(!menuOpen)}
                                    className="bg-white rounded-lg shadow-md px-4 py-2 text-gray-700 hover:bg-gray-50 transition"
                                >
                                    ‚ò∞ Menu
                                </button>
                                
                                {menuOpen && (
                                    <div className="absolute top-12 left-0 bg-white rounded-lg shadow-xl border border-gray-200 w-64 z-10">
                                        <button
                                            onClick={() => {
                                                setCurrentView('myEntries');
                                                setMenuOpen(false);
                                            }}
                                            className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2 border-b border-gray-100"
                                        >
                                            üìù My Entries
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowShareModal(true);
                                                setMenuOpen(false);
                                            }}
                                            className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2 border-b border-gray-100"
                                        >
                                            üéâ Share the Joy
                                        </button>
                                        <button
                                            onClick={() => {
                                                toggleNotifications();
                                            }}
                                            className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2"
                                        >
                                            {userSettings.emailNotifications ? 'üîî' : 'üîï'} Email Notifications: {userSettings.emailNotifications ? 'ON' : 'OFF'}
                                        </button>
                                        {currentView === 'myEntries' && (
                                            <button
                                                onClick={() => {
                                                    setCurrentView('community');
                                                    setMenuOpen(false);
                                                }}
                                                className="w-full text-left px-4 py-3 hover:bg-gray-50 flex items-center gap-2 border-t border-gray-100"
                                            >
                                                üåç Back to Community
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-lg shadow-md px-4 py-2 text-sm text-gray-700">
                                üïê {formatCurrentDateTime()}
                            </div>
                        </div>

                        {showShareModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4">Share the Joy! üéâ</h3>
                                    <p className="text-gray-600 mb-6">
                                        Invite friends to join Rose, Bud & Thorn Journal
                                    </p>
                                    <div className="mb-4">
                                        <label className="text-sm font-semibold text-gray-700 mb-2 block">
                                            Email Address (Optional)
                                        </label>
                                        <input
                                            type="email"
                                            value={shareEmail}
                                            onChange={(e) => setShareEmail(e.target.value)}
                                            placeholder="friend@example.com"
                                            className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-gray-400 focus:outline-none"
                                        />
                                    </div>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={handleShareViaEmail}
                                            className="flex-1 bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-700 transition"
                                        >
                                            Send Email
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowShareModal(false);
                                                setShareEmail('');
                                            }}
                                            className="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-300 transition"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <header className="text-center py-8">
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">Rose, Bud & Thorn</h1>
                            <p className="text-gray-600">
                                {currentView === 'myEntries' ? 'Your Personal Reflections' : 'Share your daily reflections'}
                            </p>
                            <div className="mt-4 flex items-center justify-center gap-4 text-sm">
                                <span className="text-gray-700">‚úâÔ∏è {user.email}</span>
                                <button onClick={handleLogout} className="text-gray-600 hover:text-gray-800 underline">
                                    Sign Out
                                </button>
                            </div>
                        </header>

                        {currentView === 'community' && (
                            <div className="bg-white rounded-2xl shadow-xl p-6 mb-8">
                                <div className="space-y-6">
                                    <div>
                                        <label className="flex items-center gap-2 text-lg font-semibold text-rose-600 mb-2">
                                            üåπ Rose - Something great that happened
                                        </label>
                                        <textarea
                                            value={rose}
                                            onChange={(e) => setRose(e.target.value)}
                                            placeholder="What made you smile today?"
                                            className="w-full p-3 border-2 border-rose-200 rounded-lg focus:border-rose-400 focus:outline-none resize-none"
                                            rows="3"
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-lg font-semibold text-amber-600 mb-2">
                                            ‚ú® Bud - Something you're looking forward to
                                        </label>
                                        <textarea
                                            value={bud}
                                            onChange={(e) => setBud(e.target.value)}
                                            placeholder="What are you excited about?"
                                            className="w-full p-3 border-2 border-amber-200 rounded-lg focus:border-amber-400 focus:outline-none resize-none"
                                            rows="3"
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-lg font-semibold text-emerald-700 mb-2">
                                            üåµ Thorn - A challenge you faced
                                        </label>
                                        <textarea
                                            value={thorn}
                                            onChange={(e) => setThorn(e.target.value)}
                                            placeholder="What was difficult today?"
                                            className="w-full p-3 border-2 border-emerald-200 rounded-lg focus:border-emerald-400 focus:outline-none resize-none"
                                            rows="3"
                                        />
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <button
                                            onClick={() => setIsPrivate(!isPrivate)}
                                            className={`flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition ${
                                                isPrivate 
                                                    ? 'bg-purple-100 border-purple-400 text-purple-700' 
                                                    : 'bg-blue-100 border-blue-400 text-blue-700'
                                            }`}
                                        >
                                            {isPrivate ? 'üîí Just for Me' : 'üåç Share with Community'}
                                        </button>
                                    </div>

                                    <button
                                        onClick={handleSubmit}
                                        disabled={submitting || !isFormValid}
                                        className="w-full bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-700 transition disabled:opacity-50"
                                    >
                                        {submitting ? 'Saving...' : 'Save Entry'}
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="space-y-4">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                {currentView === 'myEntries' ? 'My Entries' : 'Community Reflections'}
                            </h2>
                            
                            {loading ? (
                                <div className="text-center py-8 text-gray-500">Loading entries...</div>
                            ) : getFilteredEntries().length === 0 ? (
                                <div className="text-center py-8 text-gray-500">
                                    {currentView === 'myEntries' 
                                        ? "You haven't created any entries yet."
                                        : "No entries yet. Be the first to share!"}
                                </div>
                            ) : (
                                getFilteredEntries().map((entry) => (
                                    <div key={entry.id} className="bg-white rounded-xl shadow-lg p-6 space-y-4">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center gap-2">
                                                <span className="font-semibold text-gray-800">{getUserDisplay(entry)}</span>
                                                {entry.isPrivate && (
                                                    <span className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">üîí Private</span>
                                                )}
                                            </div>
                                            <div className="flex items-center gap-2 text-sm text-gray-500">
                                                üìÖ {formatDate(entry.date)}
                                            </div>
                                        </div>

                                        <div className="space-y-3">
                                            <div className="flex gap-3">
                                                <span className="text-rose-500 flex-shrink-0">üåπ</span>
                                                <div>
                                                    <p className="font-semibold text-rose-600 text-sm">Rose</p>
                                                    <p className="text-gray-700">{entry.rose}</p>
                                                </div>
                                            </div>

                                            <div className="flex gap-3">
                                                <span className="text-amber-500 flex-shrink-0">‚ú®</span>
                                                <div>
                                                    <p className="font-semibold text-amber-600 text-sm">Bud</p>
                                                    <p className="text-gray-700">{entry.bud}</p>
                                                </div>
                                            </div>

                                            <div className="flex gap-3">
                                                <span className="text-emerald-600 flex-shrink-0">üåµ</span>
                                                <div>
                                                    <p className="font-semibold text-emerald-700 text-sm">Thorn</p>
                                                    <p className="text-gray-700">{entry.thorn}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex items-center gap-6 pt-4 border-t border-gray-100">
                                            <button
                                                onClick={() => handleReaction(entry.id, 'heart')}
                                                className={`flex items-center gap-2 transition ${
                                                    userReactions[`${entry.id}-heart`] ? 'text-red-500' : 'text-gray-600 hover:text-red-500'
                                                }`}
                                            >
                                                <span>{userReactions[`${entry.id}-heart`] ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                                                <span className="text-sm">{entry.reactions?.heart || 0}</span>
                                            </button>
                                            <button
                                                onClick={() => handleReaction(entry.id, 'like')}
                                                className={`flex items-center gap-2 transition ${
                                                    userReactions[`${entry.id}-like`] ? 'text-blue-500' : 'text-gray-600 hover:text-blue-500'
                                                }`}
                                            >
                                                <span>üëç</span>
                                                <span className="text-sm">{entry.reactions?.like || 0}</span>
                                            </button>
                                            <button
                                                onClick={() => handleReaction(entry.id, 'celebrate')}
                                                className={`flex items-center gap-2 transition ${
                                                    userReactions[`${entry.id}-celebrate`] ? 'text-amber-500' : 'text-gray-600 hover:text-amber-500'
                                                }`}
                                            >
                                                <span>üéâ</span>
                                                <span className="text-sm">{entry.reactions?.celebrate || 0}</span>
                                            </button>
                                            <button
                                                onClick={() => handleReaction(entry.id, 'compassion')}
                                                className={`flex items-center gap-2 transition ${
                                                    userReactions[`${entry.id}-compassion`] ? 'text-purple-500' : 'text-gray-600 hover:text-purple-500'
                                                }`}
                                            >
                                                <span>ü§ó</span>
                                                <span className="text-sm">{entry.reactions?.compassion || 0}</span>
                                            </button>
                                            <button
                                                onClick={() => setShowComments({ ...showComments, [entry.id]: !showComments[entry.id] })}
                                                className="flex items-center gap-2 text-gray-600 hover:text-green-500 transition ml-auto"
                                            >
                                                <span>üí¨</span>
                                                <span className="text-sm">{entry.comments?.length || 0}</span>
                                            </button>
                                        </div>

                                        {showComments[entry.id] && (
                                            <div className="pt-4 border-t border-gray-100 space-y-4">
                                                {entry.comments && entry.comments.length > 0 && (
                                                    <div className="space-y-3">
                                                        {entry.comments.map((comment) => (
                                                            <div key={comment.id} className="bg-gray-50 rounded-lg p-3">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="font-semibold text-sm text-gray-800">
                                                                        {comment.userEmail || (comment.username && comment.location ? `${comment.username} ‚Ä¢ ${comment.location}` : 'Anonymous')}
                                                                    </span>
                                                                    <span className="text-xs text-gray-400 ml-auto">{formatDate(comment.date)}</span>
                                                                </div>
                                                                <p className="text-gray-700 text-sm">{comment.text}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        value={commentText[entry.id] || ''}
                                                        onChange={(e) => setCommentText({ ...commentText, [entry.id]: e.target.value })}
                                                        placeholder="Add a comment..."
                                                        className="flex-1 p-2 border-2 border-gray-200 rounded-lg focus:border-gray-400 focus:outline-none text-sm"
                                                        onKeyPress={(e) => e.key === 'Enter' && handleComment(entry.id)}
                                                    />
                                                    <button
                                                        onClick={() => handleComment(entry.id)}
                                                        className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition text-sm font-semibold"
                                                    >
                                                        Post
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(JournalApp));
    </script>
</body>
</html>